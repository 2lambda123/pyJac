#! /usr/bin/env python2.7
from distutils.core import setup, Extension
import distutils.ccompiler

from Cython.Distutils import build_ext
import parallel_compiler as pcc
import numpy
import os

sources = ['$homepath/pyjacob_wrapper.pyx',
           '$buildpath/dydt.c',
           '$buildpath/rxn_rates.c',
           '$buildpath/rxn_rates_pres_mod.c',
           '$buildpath/spec_rates.c',
           '$buildpath/chem_utils.c',
           '$buildpath/jacob.c'
           ]
includes = ['$buildpath/']

distutils.ccompiler.CCompiler.compile = pcc.parallelCompile

# Look for file with list of Jacobian files
if os.path.exists('$buildpath/jacobs') and os.path.isfile('$buildpath/jacobs/jac_list_c'):
    with open('$buildpath/jacobs/jac_list_c', 'r') as f:
        line = f.readline()
    files = line.split()
    sources += ['$buildpath/jacobs/' + f for f in files]
    includes += ['$buildpath/jacobs/']

ext_modules=[Extension("pyjacob",
     sources=sources,
     include_dirs=includes + [numpy.get_include()],
     extra_compile_args=['-frounding-math', '-fsignaling-nans'],
     language='c',
     libraries=['$libname'],
     library_dirs=['$homepath']
     )]

setup(
    name='pyjacob',
    ext_modules=ext_modules,
    cmdclass={'build_ext': build_ext}
)
